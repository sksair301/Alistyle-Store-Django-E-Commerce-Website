{% extends "base.html" %}
{% load static %}

{% block content %}

<!-- ========================= SECTION CONTENT ========================= -->
<style>
	.text-pink {
		color: #ff4081 !important;
	  }
	  
	  .wishlist-btn.active {
		border-color: #ff4081;
		background-color: rgba(255, 64, 129, 0.1);
	  }
	  
	  .wishlist-btn i {
		transition: color 0.3s ease;
	  }
	  
</style>

{% if messages %}
  <div class="mt-3">
    {% for message in messages %}
      <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
        {{ message }}
       
      </div>
    {% endfor %}
  </div>
{% endif %}


<section class="section-content padding-y">
<div class="container">

<div class="row">
	<!-- Sidebar Filters -->
	<aside class="col-md-2">

		<!-- Product Type Filter -->
		<article class="filter-group">
			<h6 class="title">
				<a href="#" class="dropdown-toggle" data-toggle="collapse" data-target="#collapse_1"> Product type </a>
			</h6>
			<div class="filter-content collapse show" id="collapse_1">
				<div class="inner">
					<ul class="list-menu">
						{% for cat in category %}
							<li><a href="{{ cat.get_url }}">{{ cat.category_name }}</a></li>
						{% endfor %}
					</ul>
				</div>
			</div>
		</article>

		<!-- Brand Filter -->
		<article class="filter-group">
			<h6 class="title">
				<a href="#" class="dropdown-toggle" data-toggle="collapse" data-target="#collapse_2"> Brands </a>
			</h6>
			<div class="filter-content collapse show" id="collapse_2">
				<div class="inner">
					{% for product in products %}
						<label class="custom-control custom-checkbox d-block">
							<input type="checkbox" class="custom-control-input">
							<div class="custom-control-label">{{ product.brand }}</div>
						</label>
					{% endfor %}
				</div>
			</div>
		</article>

		<!-- Price Range Filter -->
		<article class="filter-group">
			<h6 class="title">
				<a href="#" class="dropdown-toggle" data-toggle="collapse" data-target="#collapse_3"> Price range </a>
			</h6>
			<div class="filter-content collapse show" id="collapse_3">
				<div class="inner">
					<form method="GET" action=".">
						<div class="form-row">
							<div class="form-group col-md-6">
								<label>Min</label>
								<input class="form-control" name="min_price" placeholder="â‚¹0" type="number" value="{{ request.GET.min_price }}">
							</div>
							<div class="form-group text-right col-md-6">
								<label>Max</label>
								<input class="form-control" name="max_price" placeholder="â‚¹10000" type="number" value="{{ request.GET.max_price }}">
							</div>
						</div>
						<button class="btn btn-block btn-primary" type="submit">Apply</button>
					</form>
				</div>
			</div>
		</article>
	</aside>

	<!-- Product List -->
	<main class="col-md-10">
		<header class="mb-3">
			<div class="form-inline">
				<strong class="mr-md-auto">{{ product_count }} Items found</strong>
			</div>
		</header>

		{% for product in products %}
		<article class="card card-product-list mb-3">
			<div class="row no-gutters">
				<aside class="col-md-3">
					<a href="{{ product.get_url }}" class="img-wrap">
						<span class="badge badge-danger">NEW</span>
						<img src="{{ product.images.url }}" alt="{{ product.product_name }}">
					</a>
				</aside>

				<div class="col-md-6">
					<div class="info-main">
						<a href="{{ product.get_url }}" class="h5 title">{{ product.product_name }}</a>
						<p class="mb-3">
							<span class="tag"><i class="fa fa-check"></i> Verified</span>
							<span class="tag">5 Years</span>
							<span class="tag">80 reviews</span>
							<span class="tag">Russia</span>
						</p>
						<p>{{ product.description }}</p>
					</div>
				</div>

				<aside class="col-sm-3">
					<div class="info-aside p-3 border rounded shadow-sm text-light">
				  
					  <div class="price-wrap mb-2">
						<span class="h5 fw-bold text-dark">â‚¹{{ product.price }}</span>
						<small class="text-muted"> / per item</small>
					  </div>
				  
					  <small class="text-warning d-block mb-3">
						<i class="fa fa-truck"></i> Paid shipping
					  </small>
				  
					  <!-- Cart & Wishlist Buttons -->
					  <div class="d-grid gap-3">
				  
						<!-- ðŸ›’ Add to Cart -->
						<a href="{% url 'add_cart' product.id %}" class="btn btn-outline-primary btn-lg w-100 mb-2">
						  <i class="fa fa-shopping-cart me-2"></i> Add to Cart
						</a>
				  
						{% if user.is_authenticated %}
						  {% if product.id in wishlist_items %}
						  
						  <button class="btn btn-light wishlist-btn active flex-fill mb-2" disabled>
							<i class="fa fa-heart text-danger"></i> Saved
						  </button>
						  <a href="{% url 'wishlist' %}" class="btn btn-success flex-fill">
							<i class="fa fa-list"></i> Go to Wishlist
						  </a>
						  {% else %}
							<!-- â¤ï¸ Product not in wishlist -->
							<a href="{% url 'toggle_wishlist' product.id %}" class="btn btn-light wishlist-btn  w-100 wishlist-btn">
							  <i class="fa fa-heart me-2"></i> Save to Wishlist
							</a>
						  {% endif %}
						{% else %}
						  <!-- ðŸ©¶ Not logged in -->
						  <a href="{% url 'login' %}?next={% url 'store' %}" class="btn btn-outline-light w-100">
							<i class="fa fa-user me-2"></i> Login to Save
						  </a>
						{% endif %}
					  </div>
				  
					</div>
				  </aside>
				  
				
			</div>
		</article>
		{% endfor %}

		<!-- Pagination -->
		<nav class="mb-4" aria-label="Page navigation sample">
			{% if products.has_other_pages %}
				<ul class="pagination">
					{% if products.has_previous %}
						<li class="page-item"><a class="page-link" href="?page={{ products.previous_page_number }}">Previous</a></li>
					{% else %}
						<li class="page-item disabled"><a class="page-link" href="#">Previous</a></li>
					{% endif %}

					{% for i in products.paginator.page_range %}
						{% if products.number == i %}
							<li class="page-item active"><a class="page-link" href="#">{{ i }}</a></li>
						{% else %}
							<li class="page-item"><a class="page-link" href="?page={{ i }}">{{ i }}</a></li>
						{% endif %}
					{% endfor %}

					{% if products.has_next %}
						<li class="page-item"><a class="page-link" href="?page={{ products.next_page_number }}">Next</a></li>
					{% else %}
						<li class="page-item disabled"><a class="page-link" href="#">Next</a></li>
					{% endif %}
				</ul>
			{% endif %}
		</nav>

		<div class="box text-center">
			<p>Did you find what you were looking for?</p>
			<a href="#" class="btn btn-light">Yes</a>
			<a href="#" class="btn btn-light">No</a>
		</div>
	</main>
</div>
</div>
</section>
<!-- ========================= SECTION CONTENT END// ========================= -->


<!-- ========================= SECTION SUBSCRIBE ========================= -->
<section class="padding-y-lg bg-light border-top">
<div class="container">
	<p class="pb-2 text-center">Delivering the latest product trends and industry news straight to your inbox</p>
	<div class="row justify-content-md-center">
		<div class="col-lg-4 col-sm-6">
			<form class="form-row">
				<div class="col-8">
					<input class="form-control" placeholder="Your Email" type="email">
				</div>
				<div class="col-4">
					<button type="submit" class="btn btn-block btn-warning">
						<i class="fa fa-envelope"></i> Subscribe
					</button>
				</div>
			</form>
			<small class="form-text">Weâ€™ll never share your email address with a third-party.</small>
		</div>
	</div>
</div>
</section>
<!-- ========================= SECTION SUBSCRIBE END// ========================= -->
<script>
	document.querySelectorAll(".wishlist-btn").forEach(btn => {
	  btn.addEventListener("click", () => btn.classList.toggle("active"));
	});
</script>
	
{% endblock %}
